# üìã TODO - Sincronizaci√≥n Google Calendar MVP

## üéØ **OBJETIVO ACTUALIZADO**
Sistema funcional que permita:
1. üîÑ **Sincronizaci√≥n autom√°tica** de eventos desde Google Calendar
2. üì± **Formulario de asistencia** completamente funcional 
3. üë• **Dashboard organizador** para ver eventos y estad√≠sticas
4. ‚úÖ **Registro de asistencias** con validaci√≥n de c√©dulas dominicanas

**META: Sistema funcional en 7 d√≠as con enfoque Google Calendar** üöÄ

---

## üî¥ **FASE 1: SINCRONIZACI√ìN GOOGLE CALENDAR** (3-4 d√≠as)

### **D√≠a 1-2: Webhook y Procesamiento de Eventos**
- [ ] **Completar Webhook Google Calendar**
  - **Descripci√≥n**: Implementar procesamiento real de eventos en webhook endpoint
  - **Criterios de Aceptaci√≥n**:
    * Webhook recibe notificaciones de Google Calendar correctamente
    * Procesa eventos creados, actualizados y eliminados
    * Maneja errores de red y datos inv√°lidos apropiadamente
    * Logs detallados para debugging de sincronizaci√≥n

- [ ] **Sincronizaci√≥n a Base de Datos**
  - **Descripci√≥n**: Convertir eventos de Google Calendar a modelo local
  - **Criterios de Aceptaci√≥n**:
    * Mapea correctamente todos los campos requeridos
    * Evita duplicados usando googleEventId √∫nico
    * Actualiza eventos existentes cuando cambian en Google
    * Mantiene integridad referencial en BD

### **D√≠a 2-3: Biblioteca Google Calendar**
- [ ] **Servicio Google Calendar API**
  - **Descripci√≥n**: Completar biblioteca para interactuar con Google Calendar
  - **Criterios de Aceptaci√≥n**:
    * Obtiene eventos de calendario espec√≠fico con filtros de fecha
    * Busca evento individual por ID
    * Lista calendarios disponibles del usuario
    * Configura watch/webhook para notificaciones autom√°ticas

- [ ] **Sincronizaci√≥n Manual de Eventos**
  - **Descripci√≥n**: Endpoint para sincronizar eventos bajo demanda
  - **Criterios de Aceptaci√≥n**:
    * Sincroniza todos los eventos de un rango de fechas
    * Respuesta incluye cantidad de eventos procesados
    * Maneja calendarios grandes sin timeout
    * Permite re-sincronizaci√≥n de eventos espec√≠ficos

### **D√≠a 3-4: Base de Datos y Validaci√≥n**
- [ ] **Esquema Final de Eventos**
  - **Descripci√≥n**: Asegurar modelo de BD completo para eventos
  - **Criterios de Aceptaci√≥n**:
    * Incluye todos los campos necesarios de Google Calendar
    * googleEventId es √∫nico y requerido
    * Campos de fecha/hora manejan zonas horarias correctamente
    * Relaciones con tabla de asistencias funcionan correctamente

- [ ] **Testing de Sincronizaci√≥n**
  - **Descripci√≥n**: Probar sincronizaci√≥n con calendario real de INAPA
  - **Criterios de Aceptaci√≥n**:
    * Eventos de prueba se sincronizan en menos de 30 segundos
    * Cambios en Google Calendar se reflejan en BD local
    * No se crean duplicados en m√∫ltiples sincronizaciones
    * Maneja eventos recurrentes apropiadamente

---

## üü° **FASE 2: FORMULARIO DE ASISTENCIA** (2-3 d√≠as)

### **D√≠a 4-5: Formulario Completamente Funcional**
- [ ] **Validaci√≥n de C√©dulas Dominicanas**
  - **Descripci√≥n**: Implementar validaci√≥n robusta de c√©dulas RD
  - **Criterios de Aceptaci√≥n**:
    * Valida formato de 11 d√≠gitos con algoritmo est√°ndar
    * Rechaza c√©dulas inv√°lidas con mensaje claro
    * Acepta entrada con o sin guiones/espacios
    * Previene env√≠o de formulario con c√©dula inv√°lida

- [ ] **UX/UI del Formulario**
  - **Descripci√≥n**: Mejorar experiencia de usuario del formulario
  - **Criterios de Aceptaci√≥n**:
    * Formulario es completamente responsive (m√≥vil/desktop)
    * Validaciones en tiempo real mientras usuario escribe
    * Mensajes de error claros y espec√≠ficos
    * Confirmaci√≥n visual inmediata al registrar asistencia

- [ ] **Prevenci√≥n de Duplicados**
  - **Descripci√≥n**: Evitar registros duplicados de asistencia
  - **Criterios de Aceptaci√≥n**:
    * No permite registrar misma c√©dula dos veces por evento
    * Mensaje claro si persona ya est√° registrada
    * Opci√≥n para actualizar datos si ya existe registro
    * Validaci√≥n tanto frontend como backend

### **D√≠a 5-6: Integraci√≥n Dashboard-Formulario**
- [ ] **Links Din√°micos para Eventos**
  - **Descripci√≥n**: Generar URLs √∫nicas para cada evento
  - **Criterios de Aceptaci√≥n**:
    * Cada evento tiene URL √∫nica basada en ID
    * URLs son f√°ciles de compartir y recordar
    * Eventos inactivos muestran mensaje apropiado
    * Redirecci√≥n autom√°tica si evento no existe

- [ ] **Estados de Eventos**
  - **Descripci√≥n**: Manejar diferentes estados de eventos
  - **Criterios de Aceptaci√≥n**:
    * Eventos futuros: formulario activo y funcional
    * Eventos en curso: formulario activo con indicador de tiempo
    * Eventos pasados: formulario deshabilitado con mensaje
    * Eventos cancelados: mensaje claro de cancelaci√≥n

---

## üü¢ **FASE 3: DASHBOARD ORGANIZADOR** (1-2 d√≠as)

### **D√≠a 6-7: Vista de Organizador**
- [ ] **Lista de Eventos Sincronizados**
  - **Descripci√≥n**: Dashboard muestra eventos desde Google Calendar
  - **Criterios de Aceptaci√≥n**:
    * Lista todos los eventos del organizador
    * Muestra informaci√≥n b√°sica (t√≠tulo, fecha, ubicaci√≥n)
    * Indica estado actual de cada evento
    * Permite acceso r√°pido a detalles de evento

- [ ] **Estad√≠sticas de Asistencia**
  - **Descripci√≥n**: Contadores y m√©tricas por evento
  - **Criterios de Aceptaci√≥n**:
    * Muestra total de asistentes registrados
    * Porcentaje de asistencia vs invitados esperados
    * Actualizaci√≥n en tiempo real al registrarse nuevos asistentes
    * Filtros por fecha y estado de evento

- [ ] **Gesti√≥n de Asistentes**
  - **Descripci√≥n**: Ver y administrar lista de asistentes
  - **Criterios de Aceptaci√≥n**:
    * Lista completa de asistentes por evento
    * Informaci√≥n detallada de cada asistente
    * Capacidad de exportar lista b√°sica
    * B√∫squeda y filtrado de asistentes

---

## üõ†Ô∏è **IMPLEMENTACI√ìN T√âCNICA CR√çTICA**

### **1. Webhook Google Calendar (PRIORIDAD #1)**
**Archivo**: `app/api/webhooks/google/calendar/route.ts`
**Responsabilidad**: Recibir y procesar notificaciones de cambios en Google Calendar
**Funciones requeridas**: Manejar eventos creados, actualizados y eliminados

### **2. Sincronizaci√≥n de Eventos**
**Archivo**: `lib/google/calendar.ts`
**Responsabilidad**: Interactuar con Google Calendar API y sincronizar a BD local
**Funciones requeridas**: Obtener eventos, mapear datos, evitar duplicados

### **3. Formulario de Asistencia**
**Archivo**: `components/forms/AttendanceForm.tsx`
**Responsabilidad**: Capturar datos de asistentes con validaciones
**Funciones requeridas**: Validar c√©dulas RD, prevenir duplicados, confirmar registro

---

## üìã **ARCHIVOS CR√çTICOS A COMPLETAR**

### **APIs Principales - Tareas**
- [ ] `app/api/webhooks/google/calendar/route.ts` - Implementar procesamiento completo de webhook
- [ ] `app/api/events/sync/route.ts` - Completar sincronizaci√≥n manual de eventos
- [ ] `app/api/events/[id]/route.ts` - Endpoint para obtener evento espec√≠fico  
- [ ] `app/api/attendance/route.ts` - Mejorar registro de asistencias con validaciones
- [ ] `app/api/events/[id]/attendees/route.ts` - Crear endpoint para lista de asistentes

### **P√°ginas Principales - Tareas**
- [ ] `app/eventos/[id]/page.tsx` - Completar formulario de asistencia p√∫blico
- [ ] `app/dashboard/eventos/page.tsx` - Crear lista de eventos para organizador
- [ ] `app/dashboard/eventos/[id]/page.tsx` - P√°gina de detalle de evento con asistentes

### **Librer√≠as de Negocio - Tareas**
- [ ] `lib/google/calendar.ts` - Implementar todas las funciones de Google Calendar API
- [ ] `lib/validations/cedula.ts` - Crear validaci√≥n robusta de c√©dulas dominicanas
- [ ] `lib/db/events.ts` - Funciones de base de datos para eventos
- [ ] `lib/db/attendance.ts` - Funciones de base de datos para asistencias

---

## üéØ **CRITERIOS DE √âXITO ACTUALIZADO**

### **Demo de Funcionalidad (5 minutos)**
1. **Crear evento en Google Calendar** ‚Üí Aparece autom√°ticamente en sistema
2. **Abrir dashboard** ‚Üí Ver evento sincronizado con datos correctos
3. **Acceder a formulario** via link √∫nico del evento
4. **Registrar asistencia** con c√©dula v√°lida ‚Üí Confirmaci√≥n inmediata
5. **Ver en dashboard** ‚Üí Estad√≠sticas actualizadas en tiempo real

### **Pruebas T√©cnicas**
- [ ] Webhook procesa eventos de Google Calendar en < 30 segundos
- [ ] Sincronizaci√≥n manual trae eventos en < 10 segundos
- [ ] Formulario valida c√©dulas dominicanas correctamente
- [ ] Dashboard carga eventos en < 3 segundos
- [ ] Registro de asistencia se guarda en < 2 segundos

---

## üö´ **FUERA DEL ALCANCE ACTUAL**

### **NO Implementar Ahora**
- ‚ùå Creaci√≥n manual de eventos (todo desde Google Calendar)
- ‚ùå Sistema de autenticaci√≥n complejo
- ‚ùå Templates de email elaborados  
- ‚ùå Reportes PDF/Excel avanzados
- ‚ùå Dashboard con gr√°ficos complejos
- ‚ùå PWA y funcionalidad offline

### **Simplificaciones Temporales**
- **Autenticaci√≥n**: Sin login inicialmente
- **Emails**: Solo confirmaciones b√°sicas
- **Reportes**: Lista simple de asistentes
- **Dashboard**: Estad√≠sticas b√°sicas sin gr√°ficos

---

## üìÖ **CRONOGRAMA REVISADO**

| D√≠a | Enfoque Principal | Entregable Clave |
|-----|------------------|------------------|
| 1-2 | Webhook + Procesamiento | ‚úÖ Eventos se sincronizan autom√°ticamente |
| 2-3 | Google Calendar API | ‚úÖ Sincronizaci√≥n manual funciona |
| 3-4 | Base de datos + Testing | ‚úÖ Datos correctos en BD |
| 4-5 | Formulario asistencia | ‚úÖ Registro funciona completamente |
| 5-6 | Dashboard organizador | ‚úÖ Vista de eventos y asistentes |
| 6-7 | Integration + Polish | üöÄ **SISTEMA FUNCIONAL** |

---

## ‚úÖ **YA COMPLETADO (Base S√≥lida)**

- [x] **Estructura del Proyecto**: Next.js 15 + Prisma + TypeScript ‚úÖ
- [x] **Esquema de Base de Datos**: Modelos Event y Checkin definidos ‚úÖ
- [x] **UI Components**: shadcn/ui configurado profesionalmente ‚úÖ
- [x] **Google Calendar Setup**: API configurada y autenticada ‚úÖ
- [x] **Webhook B√°sico**: Endpoint creado (necesita completar l√≥gica) ‚úÖ
- [x] **Formulario Base**: Estructura b√°sica del formulario existe ‚úÖ

---

## üìù **NOTAS DE DESARROLLO**

### **Prioridad Absoluta: Google Calendar**
El sistema debe funcionar **100% sincronizado** con Google Calendar. Los organizadores de INAPA crean eventos en su calendario corporativo y el sistema debe detectarlos autom√°ticamente.

### **Flujo de Trabajo Real**
1. **Organizador INAPA** crea evento en Google Calendar corporativo
2. **Google Calendar** env√≠a webhook al sistema
3. **Sistema** procesa y guarda evento en BD local
4. **Sistema** genera link √∫nico para formulario de asistencia
5. **Organizador** comparte link con invitados
6. **Invitados** llenan formulario con datos personales
7. **Organizador** ve estad√≠sticas en dashboard

### **Validaci√≥n C√©dulas RD**
Implementar algoritmo est√°ndar de validaci√≥n de c√©dulas dominicanas (d√≠gito verificador) para asegurar datos de calidad.

---

**√öltima actualizaci√≥n**: Agosto 26, 2025  
**Versi√≥n**: 2.0 - Google Calendar First  
**Estado**: ÔøΩ En desarrollo - Sincronizaci√≥n en progreso

---

## üî¥ **FASE 1: MVP CORE** (3-4 d√≠as)

### **D√≠a 1-2: Sistema de Emails B√°sico**
- [ ] **Gmail Service Funcional**: Implementar env√≠o real en `lib/google/gmail.ts`
  ```typescript
  // Funciones m√≠nimas:
  sendEmail(to, subject, html)
  sendEmailWithAttachment(to, subject, html, attachment)
  ```
- [ ] **Template B√°sico**: Un solo template responsive para todos los emails
- [ ] **Test de Env√≠o**: Verificar que lleguen emails a Gmail/Outlook

### **D√≠a 2-3: Generaci√≥n de QR y PDFs B√°sicos** 
- [ ] **QR Generator**: Implementar generaci√≥n de c√≥digos QR
- [ ] **PDF Simple**: Crear PDF b√°sico con QR para eventos
- [ ] **Integrar con Emails**: Adjuntar PDF autom√°ticamente

### **D√≠a 3-4: Dashboard Funcional B√°sico**
- [ ] **CRUD Eventos**: Crear/editar/eliminar eventos desde dashboard
- [ ] **Env√≠o Manual**: Bot√≥n para enviar QR por email
- [ ] **Vista de Asistencias**: Lista simple de registrados por evento

### üîÑ Sincronizaci√≥n Google Calendar
- [ ] **Procesamiento Real**: Completar `processCalendarEventChange()` en webhook
- [ ] **Actualizaci√≥n de Eventos**: Manejar cambios de fecha/hora/ubicaci√≥n
- [ ] **Eventos Cancelados**: Procesar cancelaciones y notificar usuarios
- [ ] **Sincronizaci√≥n Manual**: Mejorar endpoint `/api/events/sync`

### üìä Generaci√≥n de Reportes
- [ ] **PDFs**: Implementar generaci√≥n de reportes PDF (`lib/pdf/`)
  - [ ] Reporte inicial con QR
  - [ ] Reporte pre-cierre con estad√≠sticas
  - [ ] Reporte final completo
- [ ] **Excel**: Exportaci√≥n a Excel (`lib/excel/`)
- [ ] **Endpoints**: Crear `/api/exports/[id]/pdf` y `/api/exports/[id]/excel`

## üü° **PRIORIDAD ALTA**

### üîê Autenticaci√≥n y Seguridad
- [ ] **Login Administradores**: Crear sistema de login (`app/login/`)
- [ ] **Middleware**: Proteger rutas del dashboard (`middleware.ts`)
- [ ] **Roles**: Sistema de permisos (Super Admin, Organizador, Visualizador)
- [ ] **Rate Limiting**: Protecci√≥n contra abuso de APIs

### üéØ Dashboard Funcional
- [ ] **CRUD Eventos**: Funcionalidad backend para gesti√≥n de eventos
- [ ] **Estad√≠sticas Tiempo Real**: Dashboard con datos actualizados
- [ ] **Gesti√≥n Asistencias**: CRUD completo de asistencias
- [ ] **Configuraci√≥n**: Panel para organizadores

## üü¢ **MEJORAS Y OPTIMIZACI√ìN**

### üß™ Testing
- [ ] **Tests Unitarios**: Jest + React Testing Library (80% cobertura)
- [ ] **Tests Integraci√≥n**: Flujos end-to-end completos
- [ ] **Tests Carga**: Soporte para 100+ usuarios simult√°neos

### ÔøΩ UX/UI
- [ ] **Mobile Responsive**: Optimizar formularios para m√≥vil
- [ ] **PWA**: Convertir en Progressive Web App
- [ ] **Offline Support**: Funcionalidad b√°sica offline

### üîß DevOps y Producci√≥n
- [ ] **CI/CD Pipeline**: GitHub Actions para deploy autom√°tico
- [ ] **Monitoreo**: Logs estructurados y m√©tricas
- [ ] **Backup Autom√°tico**: Estrategia de respaldo de datos
- [ ] **Documentaci√≥n Admin**: Gu√≠as para administradores

## ‚úÖ **COMPLETADO**

- [x] **Documentaci√≥n**: Organizar folder de documentaci√≥n ‚úÖ
- [x] **Estructura Base**: Proyecto Next.js con Prisma ‚úÖ
- [x] **Formulario Asistencia**: Funcionalidad b√°sica ‚úÖ
- [x] **API Emails**: Endpoint b√°sico `/api/mail/send` ‚úÖ
- [x] **Webhook Google**: Endpoint b√°sico (solo logs) ‚úÖ

---

## üìä **ESTADO GENERAL**

| M√≥dulo | Estado | D√≠as Est. |
|--------|--------|-----------|
| üìß Correos | 40% | 3-4 d√≠as |
| üîÑ Sincronizaci√≥n | 30% | 2-3 d√≠as |
| üìä Reportes | 0% | 4-5 d√≠as |
| üîê Autenticaci√≥n | 10% | 2-3 d√≠as |
| üéØ Dashboard | 20% | 3-4 d√≠as |

**TOTAL: 15-20 d√≠as para producci√≥n**

## üìù **Notas de Desarrollo**

Para nuevas tareas, usar el formato:
```markdown
- [ ] **Categor√≠a**: Descripci√≥n de la tarea
```

Ver documentaci√≥n detallada en: [docs/production/funcionalidades-faltantes.md](./docs/production/funcionalidades-faltantes.md)

## üè∑Ô∏è **Etiquetas**

- **ÔøΩ Cr√≠tico**: Bloqueante para producci√≥n
- **ÔøΩ Alta**: Importante para funcionalidad completa  
- **ÔøΩ Media**: Mejoras y optimizaci√≥n
- **‚úÖ Completado**: Tareas finalizadas